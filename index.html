<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Beer Label Generator</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="layout">
    <section class="controls" aria-labelledby="form-title">
      <h1 id="form-title">Beer Label Generator</h1>
      <p class="controls__intro">
        Enter the beer style and packaged date below, then print the page to create 18 labels per A4 sheet.
      </p>
      <form id="label-form">
        <div class="field">
          <label for="style">Style</label>
          <input id="style" name="style" type="text" placeholder="e.g. Hazy IPA" required />
        </div>
        <div class="field">
          <label for="packaged">Packaged on</label>
          <input id="packaged" name="packaged" type="date" />
        </div>
        <div class="field">
          <label for="notes">Notes (optional)</label>
          <textarea id="notes" name="notes" rows="4" placeholder="Enter notes for the back side of labels..."></textarea>
        </div>
        <div class="actions">
          <button type="button" id="print">Print Front</button>
          <button type="button" id="print-back" disabled>Print Back</button>
        </div>
      </form>
      <p class="controls__hint">Tip: Labels automatically update as you type. Use the Print button once you're happy with the preview.</p>
    </section>

    <section class="sheet" aria-label="Label sheet preview (front)">
      <div id="labels" class="labels" aria-live="polite"></div>
    </section>

    <section class="sheet sheet--back" aria-label="Label sheet preview (back)" style="display: none;">
      <div id="labels-back" class="labels labels--back" aria-live="polite"></div>
    </section>
  </main>

  <script type="module">
    const LABEL_COUNT = 18;

    const form = document.getElementById('label-form');
    const styleInput = document.getElementById('style');
    const packagedInput = document.getElementById('packaged');
    const notesInput = document.getElementById('notes');
    const labelsContainer = document.getElementById('labels');
    const labelsBackContainer = document.getElementById('labels-back');
    const printButton = document.getElementById('print');
    const printBackButton = document.getElementById('print-back');
    const backSheet = document.querySelector('.sheet--back');

    packagedInput.value = new Date().toISOString().split('T')[0];

    function formatDate(value) {
      if (!value) {
        return '';
      }

      const date = new Date(value);

      if (Number.isNaN(date.getTime())) {
        return value;
      }

      return date.toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
      });
    }

    function createLine(label, value, modifier) {
      const wrapper = document.createElement('div');
      wrapper.className = `label__line label__line--${modifier}`;

      const valueText = document.createElement('span');
      valueText.className = 'label__line-value';

      if (value) {
        valueText.textContent = value;
      } else {
        valueText.classList.add('label__line-value--empty');
        valueText.innerHTML = '&nbsp;';
      }

      wrapper.append(valueText);
      return wrapper;
    }

    function createLabelElements(styleValue, packagedValue) {
      labelsContainer.innerHTML = '';

      const styleText = styleValue || '';
      const packagedText = formatDate(packagedValue);

      for (let index = 0; index < LABEL_COUNT; index += 1) {
        const label = document.createElement('article');
        label.className = 'label';
        label.setAttribute('role', 'group');
        label.setAttribute('aria-label', `Label ${index + 1}`);

        // set background image for label
        label.style.backgroundImage = 'url("assets/front.png")';

        const lines = document.createElement('div');
        lines.className = 'label__lines';

        const styleLine = createLine('style', styleText, 'style');
        const packagedLine = createLine('packaged', packagedText, 'packaged');

        lines.append(styleLine, packagedLine);

        label.append(lines);
        labelsContainer.append(label);
      }
    }

    function createBackLabelElements(notesValue) {
      labelsBackContainer.innerHTML = '';

      const notesText = notesValue || '';

      for (let index = 0; index < LABEL_COUNT; index += 1) {
        const label = document.createElement('article');
        label.className = 'label label--back';
        label.setAttribute('role', 'group');
        label.setAttribute('aria-label', `Back Label ${index + 1}`);

        // set background image for back label
        label.style.backgroundImage = 'url("assets/back.png")';

        const notesContainer = document.createElement('div');
        notesContainer.className = 'label__notes';

        if (notesText) {
          notesContainer.textContent = notesText;
        } else {
          notesContainer.innerHTML = '&nbsp;';
        }

        label.append(notesContainer);
        labelsBackContainer.append(label);
      }
    }

    function handleSubmit(event) {
      event.preventDefault();
      createLabelElements(styleInput.value.trim(), packagedInput.value.trim());
      updateBackLabels();
    }

    function handleInputChange() {
      createLabelElements(styleInput.value.trim(), packagedInput.value.trim());
      updateBackLabels();
    }

    function updateBackLabels() {
      const notesValue = notesInput.value.trim();
      
      // Enable/disable Print Back button based on notes content
      printBackButton.disabled = !notesValue;
      
      // Show/hide back sheet based on notes content
      if (notesValue) {
        backSheet.style.display = '';
        createBackLabelElements(notesValue);
      } else {
        backSheet.style.display = 'none';
      }
    }

    form.addEventListener('submit', handleSubmit);
    form.addEventListener('input', handleInputChange);

    printButton.addEventListener('click', () => {
      // Hide back sheet when printing front only
      const wasBackVisible = backSheet.style.display !== 'none';
      backSheet.style.display = 'none';
      window.print();
      if (wasBackVisible) {
        backSheet.style.display = '';
      }
    });

    printBackButton.addEventListener('click', () => {
      // Hide front sheet when printing back only
      const frontSheet = document.querySelector('.sheet:not(.sheet--back)');
      const wasFrontVisible = frontSheet.style.display !== 'none';
      frontSheet.style.display = 'none';
      backSheet.style.display = '';
      window.print();
      frontSheet.style.display = '';
      if (!notesInput.value.trim()) {
        backSheet.style.display = 'none';
      }
    });

    createLabelElements('', '');
    updateBackLabels();
  </script>
</body>
</html>
